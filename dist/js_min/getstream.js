!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.stream=e()}}(function(){var define,module,exports;return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(_dereq_,module,exports){(function(process,global){!function(){"use strict";var Faye={VERSION:"1.1.0",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:"undefined"!=typeof window?window:global,extend:function(e,t,n){if(!t)return e;for(var i in t)t.hasOwnProperty(i)&&(e.hasOwnProperty(i)&&n===!1||e[i]!==t[i]&&(e[i]=t[i]));return e},random:function(e){e=e||this.ID_LENGTH;for(var t=Math.ceil(e*Math.log(2)/Math.log(36)),n=csprng(e,36);n.length<t;)n="0"+n;return n},validateOptions:function(e,t){for(var n in e)if(this.indexOf(t,n)<0)throw new Error("Unrecognized option: "+n)},clientIdFromMessages:function(e){var t=this.filter([].concat(e),function(e){return"/meta/connect"===e.channel});return t[0]&&t[0].clientId},copyObject:function(e){var t,n,i;if(e instanceof Array){for(t=[],n=e.length;n--;)t[n]=Faye.copyObject(e[n]);return t}if("object"==typeof e){t=null===e?null:{};for(i in e)t[i]=Faye.copyObject(e[i]);return t}return e},commonElement:function(e,t){for(var n=0,i=e.length;i>n;n++)if(-1!==this.indexOf(t,e[n]))return e[n];return null},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},map:function(e,t,n){if(e.map)return e.map(t,n);var i=[];if(e instanceof Array)for(var r=0,s=e.length;s>r;r++)i.push(t.call(n||null,e[r],r));else for(var o in e)e.hasOwnProperty(o)&&i.push(t.call(n||null,o,e[o]));return i},filter:function(e,t,n){if(e.filter)return e.filter(t,n);for(var i=[],r=0,s=e.length;s>r;r++)t.call(n||null,e[r],r)&&i.push(e[r]);return i},asyncEach:function(e,t,n,i){var r=e.length,s=-1,o=0,a=!1,c=function(){return o-=1,s+=1,s===r?n&&n.call(i):(t(e[s],h),void 0)},u=function(){if(!a){for(a=!0;o>0;)c();a=!1}},h=function(){o+=1,u()};h()},toJSON:function(e){return this.stringify?this.stringify(e,function(e,t){return this[e]instanceof Array?this[e]:t}):JSON.stringify(e)}};"undefined"!=typeof module?module.exports=Faye:"undefined"!=typeof window&&(window.Faye=Faye),Faye.Class=function(e,t){"function"!=typeof e&&(t=e,e=Object);var n=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},i=function(){};return i.prototype=e.prototype,n.prototype=new i,Faye.extend(n.prototype,t),n},function(){function e(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}var t=Faye.EventEmitter=function(){},n="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||n(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var i=Array.prototype.slice.call(arguments,1);t.apply(this,i)}return!0}if(n(t)){for(var i=Array.prototype.slice.call(arguments,1),r=t.slice(),s=0,o=r.length;o>s;s++)r[s].apply(this,i);return!0}return!1},t.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var n=this;return n.on(e,function i(){n.removeListener(e,i),t.apply(this,arguments)}),this},t.prototype.removeListener=function(t,i){if("function"!=typeof i)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var r=this._events[t];if(n(r)){var s=e(r,i);if(0>s)return this;r.splice(s,1),0==r.length&&delete this._events[t]}else this._events[t]===i&&delete this._events[t];return this},t.prototype.removeAllListeners=function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},t.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}(),Faye.Namespace=Faye.Class({initialize:function(){this._used={}},exists:function(e){return this._used.hasOwnProperty(e)},generate:function(){for(var e=Faye.random();this._used.hasOwnProperty(e);)e=Faye.random();return this._used[e]=e},release:function(e){delete this._used[e]}}),function(){var e,t=setTimeout;e="function"==typeof setImmediate?function(e){setImmediate(e)}:"object"==typeof process&&process.nextTick?function(e){process.nextTick(e)}:function(e){t(e,0)};var n=0,i=1,r=2,s=function(e){return e},o=function(e){throw e},a=function(e){if(this._state=n,this._onFulfilled=[],this._onRejected=[],"function"==typeof e){var t=this;e(function(e){f(t,e)},function(e){p(t,e)})}};a.prototype.then=function(e,t){var n=new a;return c(this,e,n),u(this,t,n),n};var c=function(e,t,r){"function"!=typeof t&&(t=s);var o=function(e){h(t,e,r)};e._state===n?e._onFulfilled.push(o):e._state===i&&o(e._value)},u=function(e,t,i){"function"!=typeof t&&(t=o);var s=function(e){h(t,e,i)};e._state===n?e._onRejected.push(s):e._state===r&&s(e._reason)},h=function(t,n,i){e(function(){l(t,n,i)})},l=function(e,t,n){var i;try{i=e(t)}catch(r){return p(n,r)}i===n?p(n,new TypeError("Recursive promise chain detected")):f(n,i)},f=a.fulfill=a.resolve=function(e,t){var n,i,r=!1;try{if(n=typeof t,i=null!==t&&("function"===n||"object"===n)&&t.then,"function"!=typeof i)return d(e,t);i.call(t,function(t){r^(r=!0)&&f(e,t)},function(t){r^(r=!0)&&p(e,t)})}catch(s){if(!(r^(r=!0)))return;p(e,s)}},d=function(e,t){if(e._state===n){e._state=i,e._value=t,e._onRejected=[];for(var r,s=e._onFulfilled;r=s.shift();)r(t)}},p=a.reject=function(e,t){if(e._state===n){e._state=r,e._reason=t,e._onFulfilled=[];for(var i,s=e._onRejected;i=s.shift();)i(t)}};a.all=function(e){return new a(function(t,n){var i,r=[],s=e.length;if(0===s)return t(r);for(i=0;s>i;i++)(function(e,i){a.fulfilled(e).then(function(e){r[i]=e,0===--s&&t(r)},n)})(e[i],i)})},a.defer=e,a.deferred=a.pending=function(){var e={};return e.promise=new a(function(t,n){e.fulfill=e.resolve=t,e.reject=n}),e},a.fulfilled=a.resolved=function(e){return new a(function(t){t(e)})},a.rejected=function(e){return new a(function(t,n){n(e)})},"undefined"==typeof Faye?module.exports=a:Faye.Promise=a}(),Faye.Set=Faye.Class({initialize:function(){this._index={}},add:function(e){var t=void 0!==e.id?e.id:e;return this._index.hasOwnProperty(t)?!1:(this._index[t]=e,!0)},forEach:function(e,t){for(var n in this._index)this._index.hasOwnProperty(n)&&e.call(t,this._index[n])},isEmpty:function(){for(var e in this._index)if(this._index.hasOwnProperty(e))return!1;return!0},member:function(e){for(var t in this._index)if(this._index[t]===e)return!0;return!1},remove:function(e){var t=void 0!==e.id?e.id:e,n=this._index[t];return delete this._index[t],n},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}}),Faye.URI={isURI:function(e){return e&&e.protocol&&e.host&&e.path},isSameOrigin:function(e){var t=Faye.ENV.location;return e.protocol===t.protocol&&e.hostname===t.hostname&&e.port===t.port},parse:function(e){if("string"!=typeof e)return e;var t,n,i,r,s,o,a={},c=function(t,n){e=e.replace(n,function(e){return a[t]=e,""}),a[t]=a[t]||""};for(c("protocol",/^[a-z]+\:/i),c("host",/^\/\/[^\/\?#]+/),/^\//.test(e)||a.host||(e=Faye.ENV.location.pathname.replace(/[^\/]*$/,"")+e),c("pathname",/^[^\?#]*/),c("search",/^\?[^#]*/),c("hash",/^#.*/),a.protocol=a.protocol||Faye.ENV.location.protocol,a.host?(a.host=a.host.substr(2),t=a.host.split(":"),a.hostname=t[0],a.port=t[1]||""):(a.host=Faye.ENV.location.host,a.hostname=Faye.ENV.location.hostname,a.port=Faye.ENV.location.port),a.pathname=a.pathname||"/",a.path=a.pathname+a.search,n=a.search.replace(/^\?/,""),i=n?n.split("&"):[],o={},r=0,s=i.length;s>r;r++)t=i[r].split("="),o[decodeURIComponent(t[0]||"")]=decodeURIComponent(t[1]||"");return a.query=o,a.href=this.stringify(a),a},stringify:function(e){var t=e.protocol+"//"+e.hostname;return e.port&&(t+=":"+e.port),t+=e.pathname+this.queryString(e.query)+(e.hash||"")},queryString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return 0===t.length?"":"?"+t.join("&")}},Faye.Error=Faye.Class({initialize:function(e,t,n){this.code=e,this.params=Array.prototype.slice.call(t),this.message=n},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),Faye.Error.parse=function(e){if(e=e||"",!Faye.Grammar.ERROR.test(e))return new this(null,[],e);var t=e.split(":"),n=parseInt(t[0]),i=t[1].split(","),e=t[2];return new this(n,i,e)},Faye.Error.versionMismatch=function(){return new this(300,arguments,"Version mismatch").toString()},Faye.Error.conntypeMismatch=function(){return new this(301,arguments,"Connection types not supported").toString()},Faye.Error.extMismatch=function(){return new this(302,arguments,"Extension mismatch").toString()},Faye.Error.badRequest=function(){return new this(400,arguments,"Bad request").toString()},Faye.Error.clientUnknown=function(){return new this(401,arguments,"Unknown client").toString()},Faye.Error.parameterMissing=function(){return new this(402,arguments,"Missing required parameter").toString()},Faye.Error.channelForbidden=function(){return new this(403,arguments,"Forbidden channel").toString()},Faye.Error.channelUnknown=function(){return new this(404,arguments,"Unknown channel").toString()},Faye.Error.channelInvalid=function(){return new this(405,arguments,"Invalid channel").toString()},Faye.Error.extUnknown=function(){return new this(406,arguments,"Unknown extension").toString()},Faye.Error.publishFailed=function(){return new this(407,arguments,"Failed to publish").toString()},Faye.Error.serverError=function(){return new this(500,arguments,"Internal server error").toString()},Faye.Deferrable={then:function(e,t){var n=this;return this._promise||(this._promise=new Faye.Promise(function(e,t){n._fulfill=e,n._reject=t})),0===arguments.length?this._promise:this._promise.then(e,t)},callback:function(e,t){return this.then(function(n){e.call(t,n)})},errback:function(e,t){return this.then(null,function(n){e.call(t,n)})},timeout:function(e,t){this.then();var n=this;this._timer=Faye.ENV.setTimeout(function(){n._reject(t)},1e3*e)},setDeferredStatus:function(e,t){this._timer&&Faye.ENV.clearTimeout(this._timer),this.then(),"succeeded"===e?this._fulfill(t):"failed"===e?this._reject(t):delete this._promise}},Faye.Publisher={countListeners:function(e){return this.listeners(e).length},bind:function(e,t,n){var i=Array.prototype.slice,r=function(){t.apply(n,i.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([e,t,n,r]),this.on(e,r)},unbind:function(e,t,n){this._listeners=this._listeners||[];for(var i,r=this._listeners.length;r--;)i=this._listeners[r],i[0]===e&&(!t||i[1]===t&&i[2]===n)&&(this._listeners.splice(r,1),this.removeListener(e,i[3]))}},Faye.extend(Faye.Publisher,Faye.EventEmitter.prototype),Faye.Publisher.trigger=Faye.Publisher.emit,Faye.Timeouts={addTimeout:function(e,t,n,i){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(e)){var r=this;this._timeouts[e]=Faye.ENV.setTimeout(function(){delete r._timeouts[e],n.call(i)},1e3*t)}},removeTimeout:function(e){this._timeouts=this._timeouts||{};var t=this._timeouts[e];t&&(Faye.ENV.clearTimeout(t),delete this._timeouts[e])},removeAllTimeouts:function(){this._timeouts=this._timeouts||{};for(var e in this._timeouts)this.removeTimeout(e)}},Faye.Logging={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(e,t){if(Faye.logger){var n=Array.prototype.slice.apply(e),i="[Faye",r=this.className,s=n.shift().replace(/\?/g,function(){try{return Faye.toJSON(n.shift())}catch(e){return"[Object]"}});for(var o in Faye)r||"function"==typeof Faye[o]&&this instanceof Faye[o]&&(r=o);r&&(i+="."+r),i+="] ","function"==typeof Faye.logger[t]?Faye.logger[t](i+s):"function"==typeof Faye.logger&&Faye.logger(i+s)}}},function(){for(var e in Faye.Logging.LOG_LEVELS)(function(e){Faye.Logging[e]=function(){this.writeLog(arguments,e)}})(e)}(),Faye.Grammar={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/},Faye.Extensible={addExtension:function(e){this._extensions=this._extensions||[],this._extensions.push(e),e.added&&e.added(this)},removeExtension:function(e){if(this._extensions)for(var t=this._extensions.length;t--;)this._extensions[t]===e&&(this._extensions.splice(t,1),e.removed&&e.removed(this))},pipeThroughExtensions:function(e,t,n,i,r){if(this.debug("Passing through ? extensions: ?",e,t),!this._extensions)return i.call(r,t);var s=this._extensions.slice(),o=function(t){if(!t)return i.call(r,t);var a=s.shift();if(!a)return i.call(r,t);var c=a[e];return c?(c.length>=3?a[e](t,n,o):a[e](t,o),void 0):o(t)};o(t)}},Faye.extend(Faye.Extensible,Faye.Logging),Faye.Channel=Faye.Class({initialize:function(e){this.id=this.name=e},push:function(e){this.trigger("message",e)},isUnused:function(){return 0===this.countListeners("message")}}),Faye.extend(Faye.Channel.prototype,Faye.Publisher),Faye.extend(Faye.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(e){var t=this.parse(e),n=["/**",e],i=t.slice();i[i.length-1]="*",n.push(this.unparse(i));for(var r=1,s=t.length;s>r;r++)i=t.slice(0,r),i.push("**"),n.push(this.unparse(i));return n},isValid:function(e){return Faye.Grammar.CHANNEL_NAME.test(e)||Faye.Grammar.CHANNEL_PATTERN.test(e)},parse:function(e){return this.isValid(e)?e.split("/").slice(1):null},unparse:function(e){return"/"+e.join("/")},isMeta:function(e){var t=this.parse(e);return t?t[0]===this.META:null},isService:function(e){var t=this.parse(e);return t?t[0]===this.SERVICE:null},isSubscribable:function(e){return this.isValid(e)?!this.isMeta(e)&&!this.isService(e):null},Set:Faye.Class({initialize:function(){this._channels={}},getKeys:function(){var e=[];for(var t in this._channels)e.push(t);return e},remove:function(e){delete this._channels[e]},hasSubscription:function(e){return this._channels.hasOwnProperty(e)},subscribe:function(e,t,n){for(var i,r=0,s=e.length;s>r;r++){i=e[r];var o=this._channels[i]=this._channels[i]||new Faye.Channel(i);t&&o.bind("message",t,n)}},unsubscribe:function(e,t,n){var i=this._channels[e];return i?(i.unbind("message",t,n),i.isUnused()?(this.remove(e),!0):!1):!1},distributeMessage:function(e){for(var t=Faye.Channel.expand(e.channel),n=0,i=t.length;i>n;n++){var r=this._channels[t[n]];r&&r.trigger("message",e.data)}}})}),Faye.Publication=Faye.Class(Faye.Deferrable),Faye.Subscription=Faye.Class({initialize:function(e,t,n,i){this._client=e,this._channels=t,this._callback=n,this._context=i,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),Faye.extend(Faye.Subscription.prototype,Faye.Deferrable),Faye.Client=Faye.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,t){this.info("New client created for ?",e),t=t||{},Faye.validateOptions(t,["interval","timeout","endpoints","proxy","retry","scheduler","websocketExtensions","tls","ca"]),this._endpoint=e||this.DEFAULT_ENDPOINT,this._channels=new Faye.Channel.Set,this._dispatcher=new Faye.Dispatcher(this,this._endpoint,t),this._messageId=0,this._state=this.UNCONNECTED,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(t.interval||this.INTERVAL),timeout:1e3*(t.timeout||this.CONNECTION_TIMEOUT)},this._dispatcher.timeout=this._advice.timeout/1e3,this._dispatcher.bind("message",this._receiveMessage,this),Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.indexOf(this._dispatcher._disabled,"autodisconnect")<0&&this.disconnect()},this)},addWebsocketExtension:function(e){return this._dispatcher.addWebsocketExtension(e)},disable:function(e){return this._dispatcher.disable(e)},setHeader:function(e,t){return this._dispatcher.setHeader(e,t)},handshake:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var n=this;this.info("Initiating handshake with ?",Faye.URI.stringify(this._endpoint)),this._dispatcher.selectTransport(Faye.MANDATORY_CONNECTION_TYPES),this._sendMessage({channel:Faye.Channel.HANDSHAKE,version:Faye.BAYEUX_VERSION,supportedConnectionTypes:this._dispatcher.getConnectionTypes()},{},function(i){i.successful?(this._state=this.CONNECTED,this._dispatcher.clientId=i.clientId,this._dispatcher.selectTransport(i.supportedConnectionTypes),this.info("Handshake successful: ?",this._dispatcher.clientId),this.subscribe(this._channels.getKeys(),!0),e&&Faye.Promise.defer(function(){e.call(t)})):(this.info("Handshake unsuccessful"),Faye.ENV.setTimeout(function(){n.handshake(e,t)},1e3*this._dispatcher.retry),this._state=this.UNCONNECTED)},this)}},connect:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,t)},this);this.callback(e,t),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._dispatcher.clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._dispatcher.clientId),this._sendMessage({channel:Faye.Channel.CONNECT,clientId:this._dispatcher.clientId,connectionType:this._dispatcher.connectionType},{},this._cycleConnection,this)))}},disconnect:function(){if(this._state===this.CONNECTED){this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._dispatcher.clientId);var e=new Faye.Publication;return this._sendMessage({channel:Faye.Channel.DISCONNECT,clientId:this._dispatcher.clientId},{},function(t){t.successful?(this._dispatcher.close(),e.setDeferredStatus("succeeded")):e.setDeferredStatus("failed",Faye.Error.parse(t.error))},this),this.info("Clearing channel listeners for ?",this._dispatcher.clientId),this._channels=new Faye.Channel.Set,e}},subscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.subscribe(e,t,n)},this);var i=new Faye.Subscription(this,e,t,n),r=t===!0,s=this._channels.hasSubscription(e);return s&&!r?(this._channels.subscribe([e],t,n),i.setDeferredStatus("succeeded"),i):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._dispatcher.clientId,e),r||this._channels.subscribe([e],t,n),this._sendMessage({channel:Faye.Channel.SUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(r){if(!r.successful)return i.setDeferredStatus("failed",Faye.Error.parse(r.error)),this._channels.unsubscribe(e,t,n);var s=[].concat(r.subscription);this.info("Subscription acknowledged for ? to ?",this._dispatcher.clientId,s),i.setDeferredStatus("succeeded")},this)},this),i)},unsubscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.unsubscribe(e,t,n)},this);var i=this._channels.unsubscribe(e,t,n);i&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._dispatcher.clientId,e),this._sendMessage({channel:Faye.Channel.UNSUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(e){if(e.successful){var t=[].concat(e.subscription);this.info("Unsubscription acknowledged for ? from ?",this._dispatcher.clientId,t)}},this)},this)},publish:function(e,t,n){Faye.validateOptions(n||{},["attempts","deadline"]);var i=new Faye.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._dispatcher.clientId,e,t),this._sendMessage({channel:e,data:t,clientId:this._dispatcher.clientId},n,function(e){e.successful?i.setDeferredStatus("succeeded"):i.setDeferredStatus("failed",Faye.Error.parse(e.error))},this)},this),i},_sendMessage:function(e,t,n,i){e.id=this._generateMessageId();var r=this._advice.timeout?1.2*this._advice.timeout/1e3:1.2*this._dispatcher.retry;this.pipeThroughExtensions("outgoing",e,null,function(e){e&&(n&&(this._responseCallbacks[e.id]=[n,i]),this._dispatcher.sendMessage(e,r,t||{}))},this)},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_receiveMessage:function(e){var t,n=e.id;void 0!==e.successful&&(t=this._responseCallbacks[n],delete this._responseCallbacks[n]),this.pipeThroughExtensions("incoming",e,null,function(e){e&&(e.advice&&this._handleAdvice(e.advice),this._deliverMessage(e),t&&t[0].call(t[1],e))},this)},_handleAdvice:function(e){Faye.extend(this._advice,e),this._dispatcher.timeout=this._advice.timeout/1e3,this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._dispatcher.clientId=null,this._cycleConnection())},_deliverMessage:function(e){e.channel&&void 0!==e.data&&(this.info("Client ? calling listeners for ? with ?",this._dispatcher.clientId,e.channel,e.data),this._channels.distributeMessage(e))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._dispatcher.clientId));var e=this;Faye.ENV.setTimeout(function(){e.connect()},this._advice.interval)}}),Faye.extend(Faye.Client.prototype,Faye.Deferrable),Faye.extend(Faye.Client.prototype,Faye.Publisher),Faye.extend(Faye.Client.prototype,Faye.Logging),Faye.extend(Faye.Client.prototype,Faye.Extensible),Faye.Dispatcher=Faye.Class({MAX_REQUEST_SIZE:2048,DEFAULT_RETRY:5,UP:1,DOWN:2,initialize:function(e,t,n){this._client=e,this.endpoint=Faye.URI.parse(t),this._alternates=n.endpoints||{},this.cookies=Faye.Cookies&&new Faye.Cookies.CookieJar,this._disabled=[],this._envelopes={},this.headers={},this.retry=n.retry||this.DEFAULT_RETRY,this._scheduler=n.scheduler||Faye.Scheduler,this._state=0,this.transports={},this.wsExtensions=[],this.proxy=n.proxy||{},"string"==typeof this._proxy&&(this._proxy={origin:this._proxy});var i=n.websocketExtensions;if(i){i=[].concat(i);for(var r=0,s=i.length;s>r;r++)this.addWebsocketExtension(i[r])}this.tls=n.tls||{},this.tls.ca=this.tls.ca||n.ca;for(var o in this._alternates)this._alternates[o]=Faye.URI.parse(this._alternates[o]);this.maxRequestSize=this.MAX_REQUEST_SIZE},endpointFor:function(e){return this._alternates[e]||this.endpoint},addWebsocketExtension:function(e){this.wsExtensions.push(e)},disable:function(e){this._disabled.push(e)},setHeader:function(e,t){this.headers[e]=t},close:function(){var e=this._transport;delete this._transport,e&&e.close()},getConnectionTypes:function(){return Faye.Transport.getConnectionTypes()},selectTransport:function(e){Faye.Transport.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,Faye.URI.stringify(e.endpoint)),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e,this.connectionType=e.connectionType)},this)},sendMessage:function(e,t,n){if(this._transport){n=n||{};var i,r=e.id,s=n.attempts,o=n.deadline&&(new Date).getTime()+1e3*n.deadline,a=this._envelopes[r];a||(i=new this._scheduler(e,{timeout:t,interval:this.retry,attempts:s,deadline:o}),a=this._envelopes[r]={message:e,scheduler:i}),this._sendEnvelope(a)}},_sendEnvelope:function(e){if(!e.request&&!e.timer){var t=e.message,n=e.scheduler,i=this;if(!n.isDeliverable())return n.abort(),delete this._envelopes[t.id],void 0;e.timer=Faye.ENV.setTimeout(function(){i.handleError(t)},1e3*n.getTimeout()),n.send(),e.request=this._transport.sendMessage(t)}},handleResponse:function(e){var t=this._envelopes[e.id];void 0!==e.successful&&t&&(t.scheduler.succeed(),delete this._envelopes[e.id],Faye.ENV.clearTimeout(t.timer)),this.trigger("message",e),this._state!==this.UP&&(this._state=this.UP,this._client.trigger("transport:up"))},handleError:function(e,t){var n=this._envelopes[e.id],i=n&&n.request,r=this;if(i){i.then(function(e){e&&e.abort&&e.abort()});var s=n.scheduler;s.fail(),Faye.ENV.clearTimeout(n.timer),n.request=n.timer=null,t?this._sendEnvelope(n):n.timer=Faye.ENV.setTimeout(function(){n.timer=null,r._sendEnvelope(n)},1e3*s.getInterval()),this._state!==this.DOWN&&(this._state=this.DOWN,this._client.trigger("transport:down"))}}}),Faye.extend(Faye.Dispatcher.prototype,Faye.Publisher),Faye.extend(Faye.Dispatcher.prototype,Faye.Logging),Faye.Scheduler=function(e,t){this.message=e,this.options=t,this.attempts=0},Faye.extend(Faye.Scheduler.prototype,{getTimeout:function(){return this.options.timeout},getInterval:function(){return this.options.interval},isDeliverable:function(){var e=this.options.attempts,t=this.attempts,n=this.options.deadline,i=(new Date).getTime();return void 0!==e&&t>=e?!1:void 0!==n&&i>n?!1:!0},send:function(){this.attempts+=1},succeed:function(){},fail:function(){},abort:function(){}}),Faye.Transport=Faye.extend(Faye.Class({DEFAULT_PORTS:{"http:":80,"https:":443,"ws:":80,"wss:":443},SECURE_PROTOCOLS:["https:","wss:"],MAX_DELAY:0,batching:!0,initialize:function(e,t){this._dispatcher=e,this.endpoint=t,this._outbox=[],this._proxy=Faye.extend({},this._dispatcher.proxy),!this._proxy.origin&&Faye.NodeAdapter&&(this._proxy.origin=Faye.indexOf(this.SECURE_PROTOCOLS,this.endpoint.protocol)>=0?process.env.HTTPS_PROXY||process.env.https_proxy:process.env.HTTP_PROXY||process.env.http_proxy)},close:function(){},encode:function(){return""},sendMessage:function(e){return this.debug("Client ? sending message to ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),e),this.batching?(this._outbox.push(e),this._flushLargeBatch(),this._promise=this._promise||new Faye.Promise,e.channel===Faye.Channel.HANDSHAKE?(this.addTimeout("publish",.01,this._flush,this),this._promise):(e.channel===Faye.Channel.CONNECT&&(this._connectMessage=e),this.addTimeout("publish",this.MAX_DELAY,this._flush,this),this._promise)):Faye.Promise.fulfilled(this.request([e]))},_flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),Faye.Promise.fulfill(this._promise,this.request(this._outbox)),delete this._promise,this._connectMessage=null,this._outbox=[]},_flushLargeBatch:function(){var e=this.encode(this._outbox);if(!(e.length<this._dispatcher.maxRequestSize)){var t=this._outbox.pop();this._flush(),t&&this._outbox.push(t)}},_receive:function(e){e=[].concat(e),this.debug("Client ? received from ? via ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),this.connectionType,e);for(var t=0,n=e.length;n>t;t++)this._dispatcher.handleResponse(e[t])},_handleError:function(e){e=[].concat(e),this.debug("Client ? failed to send to ? via ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),this.connectionType,e);for(var t=0,n=e.length;n>t;t++)this._dispatcher.handleError(e[t])},_getCookies:function(){var e=this._dispatcher.cookies,t=Faye.URI.stringify(this.endpoint);return e?Faye.map(e.getCookiesSync(t),function(e){return e.cookieString()}).join("; "):""},_storeCookies:function(e){var t,n=this._dispatcher.cookies,i=Faye.URI.stringify(this.endpoint);if(e&&n){e=[].concat(e);for(var r=0,s=e.length;s>r;r++)t=Faye.Cookies.Cookie.parse(e[r]),n.setCookieSync(t,i)}}}),{get:function(e,t,n,i,r){var s=e.endpoint;Faye.asyncEach(this._transports,function(s,o){var a=s[0],c=s[1],u=e.endpointFor(a);return Faye.indexOf(n,a)>=0?o():Faye.indexOf(t,a)<0?(c.isUsable(e,u,function(){}),o()):(c.isUsable(e,u,function(t){if(!t)return o();var n=c.hasOwnProperty("create")?c.create(e,u):new c(e,u);i.call(r,n)}),void 0)},function(){throw new Error("Could not find a usable connection type for "+Faye.URI.stringify(s))})},register:function(e,t){this._transports.push([e,t]),t.prototype.connectionType=e},getConnectionTypes:function(){return Faye.map(this._transports,function(e){return e[0]})},_transports:[]}),Faye.extend(Faye.Transport.prototype,Faye.Logging),Faye.extend(Faye.Transport.prototype,Faye.Timeouts),Faye.Event={_registry:[],on:function(e,t,n,i){var r=function(){n.call(i)};e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent("on"+t,r),this._registry.push({_element:e,_type:t,_callback:n,_context:i,_handler:r})},detach:function(e,t,n,i){for(var r,s=this._registry.length;s--;)r=this._registry[s],e&&e!==r._element||t&&t!==r._type||n&&n!==r._callback||i&&i!==r._context||(r._element.removeEventListener?r._element.removeEventListener(r._type,r._handler,!1):r._element.detachEvent("on"+r._type,r._handler),this._registry.splice(s,1),r=null)}},void 0!==Faye.ENV.onunload&&Faye.Event.on(Faye.ENV,"unload",Faye.Event.detach,Faye.Event),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,s,o,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,n=0;s>n;n+=1)o[n]=str(n,c)||"null";return r=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;s>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],r=str(i,c),r&&o.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c),r&&o.push(quote(i)+(gap?": ":":")+r));return r=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()
});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;Faye.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},"function"!=typeof JSON.stringify&&(JSON.stringify=Faye.stringify),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Faye.Transport.WebSocket=Faye.extend(Faye.Class(Faye.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)}),this.connect()},request:function(e){this._pending=this._pending||new Faye.Set;for(var t=0,n=e.length;n>t;t++)this._pending.add(e[t]);var i=new Faye.Promise;return this.callback(function(t){t&&(t.send(Faye.toJSON(e)),Faye.Promise.fulfill(i,t))},this),this.connect(),{abort:function(){i.then(function(e){e.close()})}}},connect:function(){if(!Faye.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=this._createSocket();if(!e)return this.setDeferredStatus("failed");var t=this;e.onopen=function(){e.headers&&t._storeCookies(e.headers["set-cookie"]),t._socket=e,t._state=t.CONNECTED,t._everConnected=!0,t._ping(),t.setDeferredStatus("succeeded",e)};var n=!1;e.onclose=e.onerror=function(){if(!n){n=!0;var i=t._state===t.CONNECTED;e.onopen=e.onclose=e.onerror=e.onmessage=null,delete t._socket,t._state=t.UNCONNECTED,t.removeTimeout("ping"),t.setDeferredStatus("unknown");var r=t._pending?t._pending.toArray():[];delete t._pending,i?t._handleError(r,!0):t._everConnected?t._handleError(r):t.setDeferredStatus("failed")}},e.onmessage=function(e){var n=JSON.parse(e.data);if(n){n=[].concat(n);for(var i=0,r=n.length;r>i;i++)void 0!==n[i].successful&&t._pending.remove(n[i]);t._receive(n)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var e=Faye.Transport.WebSocket.getSocketUrl(this.endpoint),t=this._dispatcher.headers,n=this._dispatcher.wsExtensions,i=this._getCookies(),r=this._dispatcher.tls,s={extensions:n,headers:t,proxy:this._proxy,tls:r};return""!==i&&(s.headers.Cookie=i),Faye.WebSocket?new Faye.WebSocket.Client(e,[],s):Faye.ENV.MozWebSocket?new MozWebSocket(e):Faye.ENV.WebSocket?new WebSocket(e):void 0},_ping:function(){this._socket&&(this._socket.send("[]"),this.addTimeout("ping",this._dispatcher.timeout/2,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(e,t){var n=e.transports.websocket=e.transports.websocket||{};return n[t.href]=n[t.href]||new this(e,t),n[t.href]},getSocketUrl:function(e){return e=Faye.copyObject(e),e.protocol=this.PROTOCOLS[e.protocol],Faye.URI.stringify(e)},isUsable:function(e,t,n,i){this.create(e,t).isUsable(n,i)}}),Faye.extend(Faye.Transport.WebSocket.prototype,Faye.Deferrable),Faye.Transport.register("websocket",Faye.Transport.WebSocket),Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.Transport.WebSocket._unloaded=!0}),Faye.Transport.EventSource=Faye.extend(Faye.Class(Faye.Transport,{initialize:function(e,t){if(Faye.Transport.prototype.initialize.call(this,e,t),!Faye.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new Faye.Transport.XHR(e,t),t=Faye.copyObject(t),t.pathname+="/"+e.clientId;var n=new EventSource(Faye.URI.stringify(t)),i=this;n.onopen=function(){i._everConnected=!0,i.setDeferredStatus("succeeded")},n.onerror=function(){i._everConnected?i._handleError([]):(i.setDeferredStatus("failed"),n.close())},n.onmessage=function(e){i._receive(JSON.parse(e.data))},this._socket=n},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)})},encode:function(e){return this._xhr.encode(e)},request:function(e){return this._xhr.request(e)}}),{isUsable:function(e,t,n,i){var r=e.clientId;return r?(Faye.Transport.XHR.isUsable(e,t,function(r){return r?(this.create(e,t).isUsable(n,i),void 0):n.call(i,!1)},this),void 0):n.call(i,!1)},create:function(e,t){var n=e.transports.eventsource=e.transports.eventsource||{},i=e.clientId;t=Faye.copyObject(t),t.pathname+="/"+(i||"");var r=Faye.URI.stringify(t);return n[r]=n[r]||new this(e,t),n[r]}}),Faye.extend(Faye.Transport.EventSource.prototype,Faye.Deferrable),Faye.Transport.register("eventsource",Faye.Transport.EventSource),Faye.Transport.XHR=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){return Faye.toJSON(e)},request:function(e){var t=this.endpoint.href,n=Faye.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,i=this;n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Pragma","no-cache"),n.setRequestHeader("X-Requested-With","XMLHttpRequest");var r=this._dispatcher.headers;for(var s in r)r.hasOwnProperty(s)&&n.setRequestHeader(s,r[s]);var o=function(){n.abort()};return void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",o),n.onreadystatechange=function(){if(n&&4===n.readyState){var t=null,r=n.status,s=n.responseText,a=r>=200&&300>r||304===r||1223===r;if(void 0!==Faye.ENV.onbeforeunload&&Faye.Event.detach(Faye.ENV,"beforeunload",o),n.onreadystatechange=function(){},n=null,!a)return i._handleError(e);try{t=JSON.parse(s)}catch(c){}t?i._receive(t):i._handleError(e)}},n.send(this.encode(e)),n}}),{isUsable:function(e,t,n,i){n.call(i,Faye.URI.isSameOrigin(t))}}),Faye.Transport.register("long-polling",Faye.Transport.XHR),Faye.Transport.CORS=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){return"message="+encodeURIComponent(Faye.toJSON(e))},request:function(e){var t,n=Faye.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,i=new n,r=this._dispatcher.headers,s=this;if(i.open("POST",Faye.URI.stringify(this.endpoint),!0),i.setRequestHeader){i.setRequestHeader("Pragma","no-cache");for(t in r)r.hasOwnProperty(t)&&i.setRequestHeader(t,r[t])}var o=function(){return i?(i.onload=i.onerror=i.ontimeout=i.onprogress=null,i=null,void 0):!1};return i.onload=function(){var t=null;try{t=JSON.parse(i.responseText)}catch(n){}o(),t?s._receive(t):s._handleError(e)},i.onerror=i.ontimeout=function(){o(),s._handleError(e)},i.onprogress=function(){},i.send(this.encode(e)),i}}),{isUsable:function(e,t,n,i){if(Faye.URI.isSameOrigin(t))return n.call(i,!1);if(Faye.ENV.XDomainRequest)return n.call(i,t.protocol===Faye.ENV.location.protocol);if(Faye.ENV.XMLHttpRequest){var r=new Faye.ENV.XMLHttpRequest;return n.call(i,void 0!==r.withCredentials)}return n.call(i,!1)}}),Faye.Transport.register("cross-origin-long-polling",Faye.Transport.CORS),Faye.Transport.JSONP=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.copyObject(this.endpoint);return t.query.message=Faye.toJSON(e),t.query.jsonp="__jsonp"+Faye.Transport.JSONP._cbCount+"__",Faye.URI.stringify(t)},request:function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script"),i=Faye.Transport.JSONP.getCallbackName(),r=Faye.copyObject(this.endpoint),s=this;r.query.message=Faye.toJSON(e),r.query.jsonp=i;var o=function(){if(!Faye.ENV[i])return!1;Faye.ENV[i]=void 0;try{delete Faye.ENV[i]}catch(e){}n.parentNode.removeChild(n)};return Faye.ENV[i]=function(e){o(),s._receive(e)},n.type="text/javascript",n.src=Faye.URI.stringify(r),t.appendChild(n),n.onerror=function(){o(),s._handleError(e)},{abort:o}}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(e,t,n,i){n.call(i,!0)}}),Faye.Transport.register("callback-polling",Faye.Transport.JSONP)}()}).call(this,_dereq_("1YiZ5S"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"1YiZ5S":2}],2:[function(e,t){function n(){}var i=t.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var i=n.shift();i()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=n,i.addListener=n,i.once=n,i.off=n,i.removeListener=n,i.removeAllListeners=n,i.emit=n,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")}},{}],3:[function(e,t,n){!function(e){function i(e,t,n){var i=0,r=[0],l="",f=null,l=n||"UTF8";if("UTF8"!==l&&"UTF16"!==l)throw"encoding must be UTF8 or UTF16";if("HEX"===t){if(0!==e.length%2)throw"srcString of HEX type must be in byte increments";f=o(e),i=f.binLen,r=f.value}else if("ASCII"===t||"TEXT"===t)f=s(e,l),i=f.binLen,r=f.value;else{if("B64"!==t)throw"inputFormat must be HEX, TEXT, ASCII, or B64";f=a(e),i=f.binLen,r=f.value}this.getHash=function(e,t,n,s){var o,a=null,l=r.slice(),f=i;if(3===arguments.length?"number"!=typeof n&&(s=n,n=1):2===arguments.length&&(n=1),n!==parseInt(n,10)||1>n)throw"numRounds must a integer >= 1";switch(t){case"HEX":a=c;break;case"B64":a=u;break;default:throw"format must be HEX or B64"}if("SHA-1"===e)for(o=0;n>o;o++)l=R(l,f),f=160;else if("SHA-224"===e)for(o=0;n>o;o++)l=D(l,f,e),f=224;else if("SHA-256"===e)for(o=0;n>o;o++)l=D(l,f,e),f=256;else if("SHA-384"===e)for(o=0;n>o;o++)l=D(l,f,e),f=384;else{if("SHA-512"!==e)throw"Chosen SHA variant is not supported";for(o=0;n>o;o++)l=D(l,f,e),f=512}return a(l,h(s))},this.getHMAC=function(e,t,n,f,d){var p,y,g,_,v=[],b=[];switch(p=null,f){case"HEX":f=c;break;case"B64":f=u;break;default:throw"outputFormat must be HEX or B64"}if("SHA-1"===n)y=64,_=160;else if("SHA-224"===n)y=64,_=224;else if("SHA-256"===n)y=64,_=256;else if("SHA-384"===n)y=128,_=384;else{if("SHA-512"!==n)throw"Chosen SHA variant is not supported";y=128,_=512}if("HEX"===t)p=o(e),g=p.binLen,p=p.value;else if("ASCII"===t||"TEXT"===t)p=s(e,l),g=p.binLen,p=p.value;else{if("B64"!==t)throw"inputFormat must be HEX, TEXT, ASCII, or B64";p=a(e),g=p.binLen,p=p.value}for(e=8*y,t=y/4-1,g/8>y?(p="SHA-1"===n?R(p,g):D(p,g,n),p[t]&=4294967040):y>g/8&&(p[t]&=4294967040),y=0;t>=y;y+=1)v[y]=909522486^p[y],b[y]=1549556828^p[y];return n="SHA-1"===n?R(b.concat(R(v.concat(r),e+i)),e+_):D(b.concat(D(v.concat(r),e+i,n)),e+_,n),f(n,h(d))}}function r(e,t){this.a=e,this.b=t}function s(e,t){var n,i,r=[],s=[],o=0;if("UTF8"===t)for(i=0;i<e.length;i+=1)for(n=e.charCodeAt(i),s=[],n>2048?(s[0]=224|(61440&n)>>>12,s[1]=128|(4032&n)>>>6,s[2]=128|63&n):n>128?(s[0]=192|(1984&n)>>>6,s[1]=128|63&n):s[0]=n,n=0;n<s.length;n+=1)r[o>>>2]|=s[n]<<24-o%4*8,o+=1;else if("UTF16"===t)for(i=0;i<e.length;i+=1)r[o>>>2]|=e.charCodeAt(i)<<16-o%4*8,o+=2;return{value:r,binLen:8*o}}function o(e){var t,n,i=[],r=e.length;if(0!==r%2)throw"String of HEX type must be in byte increments";for(t=0;r>t;t+=2){if(n=parseInt(e.substr(t,2),16),isNaN(n))throw"String of HEX type contains invalid characters";i[t>>>3]|=n<<24-t%8*4}return{value:i,binLen:4*r}}function a(e){var t,n,i,r,s,o=[],a=0;if(-1===e.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(t=e.indexOf("="),e=e.replace(/\=/g,""),-1!==t&&t<e.length)throw"Invalid '=' found in base-64 string";for(n=0;n<e.length;n+=4){for(s=e.substr(n,4),i=r=0;i<s.length;i+=1)t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(s[i]),r|=t<<18-6*i;for(i=0;i<s.length-1;i+=1)o[a>>2]|=(r>>>16-8*i&255)<<24-a%4*8,a+=1}return{value:o,binLen:8*a}}function c(e,t){var n,i,r="",s=4*e.length;for(n=0;s>n;n+=1)i=e[n>>>2]>>>8*(3-n%4),r+="0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i);return t.outputUpper?r.toUpperCase():r}function u(e,t){var n,i,r,s="",o=4*e.length;for(n=0;o>n;n+=3)for(r=(e[n>>>2]>>>8*(3-n%4)&255)<<16|(e[n+1>>>2]>>>8*(3-(n+1)%4)&255)<<8|e[n+2>>>2]>>>8*(3-(n+2)%4)&255,i=0;4>i;i+=1)s=8*n+6*i<=32*e.length?s+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6*(3-i)&63):s+t.b64Pad;return s}function h(e){var t={outputUpper:!1,b64Pad:"="};try{e.hasOwnProperty("outputUpper")&&(t.outputUpper=e.outputUpper),e.hasOwnProperty("b64Pad")&&(t.b64Pad=e.b64Pad)}catch(n){}if("boolean"!=typeof t.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof t.b64Pad)throw"Invalid b64Pad formatting option";return t}function l(e,t){return e<<t|e>>>32-t}function f(e,t){return e>>>t|e<<32-t}function d(e,t){var n=null,n=new r(e.a,e.b);return n=32>=t?new r(n.a>>>t|n.b<<32-t&4294967295,n.b>>>t|n.a<<32-t&4294967295):new r(n.b>>>t-32|n.a<<64-t&4294967295,n.a>>>t-32|n.b<<64-t&4294967295)}function p(e,t){var n=null;return n=32>=t?new r(e.a>>>t,e.b>>>t|e.a<<32-t&4294967295):new r(0,e.a>>>t-32)}function y(e,t,n){return e^t^n}function g(e,t,n){return e&t^~e&n}function _(e,t,n){return new r(e.a&t.a^~e.a&n.a,e.b&t.b^~e.b&n.b)}function v(e,t,n){return e&t^e&n^t&n}function b(e,t,n){return new r(e.a&t.a^e.a&n.a^t.a&n.a,e.b&t.b^e.b&n.b^t.b&n.b)}function m(e){return f(e,2)^f(e,13)^f(e,22)}function w(e){var t=d(e,28),n=d(e,34);return e=d(e,39),new r(t.a^n.a^e.a,t.b^n.b^e.b)}function F(e){return f(e,6)^f(e,11)^f(e,25)}function E(e){var t=d(e,14),n=d(e,18);return e=d(e,41),new r(t.a^n.a^e.a,t.b^n.b^e.b)}function S(e){return f(e,7)^f(e,18)^e>>>3}function C(e){var t=d(e,1),n=d(e,8);return e=p(e,7),new r(t.a^n.a^e.a,t.b^n.b^e.b)}function N(e){return f(e,17)^f(e,19)^e>>>10}function T(e){var t=d(e,19),n=d(e,61);return e=p(e,6),new r(t.a^n.a^e.a,t.b^n.b^e.b)}function x(e,t){var n=(65535&e)+(65535&t);return((e>>>16)+(t>>>16)+(n>>>16)&65535)<<16|65535&n}function O(e,t,n,i){var r=(65535&e)+(65535&t)+(65535&n)+(65535&i);return((e>>>16)+(t>>>16)+(n>>>16)+(i>>>16)+(r>>>16)&65535)<<16|65535&r}function I(e,t,n,i,r){var s=(65535&e)+(65535&t)+(65535&n)+(65535&i)+(65535&r);return((e>>>16)+(t>>>16)+(n>>>16)+(i>>>16)+(r>>>16)+(s>>>16)&65535)<<16|65535&s}function k(e,t){var n,i,s;return n=(65535&e.b)+(65535&t.b),i=(e.b>>>16)+(t.b>>>16)+(n>>>16),s=(65535&i)<<16|65535&n,n=(65535&e.a)+(65535&t.a)+(i>>>16),i=(e.a>>>16)+(t.a>>>16)+(n>>>16),new r((65535&i)<<16|65535&n,s)}function A(e,t,n,i){var s,o,a;return s=(65535&e.b)+(65535&t.b)+(65535&n.b)+(65535&i.b),o=(e.b>>>16)+(t.b>>>16)+(n.b>>>16)+(i.b>>>16)+(s>>>16),a=(65535&o)<<16|65535&s,s=(65535&e.a)+(65535&t.a)+(65535&n.a)+(65535&i.a)+(o>>>16),o=(e.a>>>16)+(t.a>>>16)+(n.a>>>16)+(i.a>>>16)+(s>>>16),new r((65535&o)<<16|65535&s,a)}function U(e,t,n,i,s){var o,a,c;return o=(65535&e.b)+(65535&t.b)+(65535&n.b)+(65535&i.b)+(65535&s.b),a=(e.b>>>16)+(t.b>>>16)+(n.b>>>16)+(i.b>>>16)+(s.b>>>16)+(o>>>16),c=(65535&a)<<16|65535&o,o=(65535&e.a)+(65535&t.a)+(65535&n.a)+(65535&i.a)+(65535&s.a)+(a>>>16),a=(e.a>>>16)+(t.a>>>16)+(n.a>>>16)+(i.a>>>16)+(s.a>>>16)+(o>>>16),new r((65535&a)<<16|65535&o,c)}function R(e,t){var n,i,r,s,o,a,c,u,h,f=[],d=g,p=y,_=v,b=l,m=x,w=I,F=[1732584193,4023233417,2562383102,271733878,3285377520];for(e[t>>>5]|=128<<24-t%32,e[(t+65>>>9<<4)+15]=t,h=e.length,c=0;h>c;c+=16){for(n=F[0],i=F[1],r=F[2],s=F[3],o=F[4],u=0;80>u;u+=1)f[u]=16>u?e[u+c]:b(f[u-3]^f[u-8]^f[u-14]^f[u-16],1),a=20>u?w(b(n,5),d(i,r,s),o,1518500249,f[u]):40>u?w(b(n,5),p(i,r,s),o,1859775393,f[u]):60>u?w(b(n,5),_(i,r,s),o,2400959708,f[u]):w(b(n,5),p(i,r,s),o,3395469782,f[u]),o=s,s=r,r=b(i,30),i=n,n=a;F[0]=m(n,F[0]),F[1]=m(i,F[1]),F[2]=m(r,F[2]),F[3]=m(s,F[3]),F[4]=m(o,F[4])}return F}function D(e,t,n){var i,s,o,a,c,u,h,l,f,d,p,y,R,D,H,L,P,q,j,M,V,X,z,J,B,Y,W=[],Z=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];if(d=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],s=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],"SHA-224"===n||"SHA-256"===n)p=64,i=(t+65>>>9<<4)+15,D=16,H=1,B=Number,L=x,P=O,q=I,j=S,M=N,V=m,X=F,J=v,z=g,d="SHA-224"===n?d:s;else{if("SHA-384"!==n&&"SHA-512"!==n)throw"Unexpected error in SHA-2 implementation";p=80,i=(t+128>>>10<<5)+31,D=32,H=2,B=r,L=k,P=A,q=U,j=C,M=T,V=w,X=E,J=b,z=_,Z=[new B(Z[0],3609767458),new B(Z[1],602891725),new B(Z[2],3964484399),new B(Z[3],2173295548),new B(Z[4],4081628472),new B(Z[5],3053834265),new B(Z[6],2937671579),new B(Z[7],3664609560),new B(Z[8],2734883394),new B(Z[9],1164996542),new B(Z[10],1323610764),new B(Z[11],3590304994),new B(Z[12],4068182383),new B(Z[13],991336113),new B(Z[14],633803317),new B(Z[15],3479774868),new B(Z[16],2666613458),new B(Z[17],944711139),new B(Z[18],2341262773),new B(Z[19],2007800933),new B(Z[20],1495990901),new B(Z[21],1856431235),new B(Z[22],3175218132),new B(Z[23],2198950837),new B(Z[24],3999719339),new B(Z[25],766784016),new B(Z[26],2566594879),new B(Z[27],3203337956),new B(Z[28],1034457026),new B(Z[29],2466948901),new B(Z[30],3758326383),new B(Z[31],168717936),new B(Z[32],1188179964),new B(Z[33],1546045734),new B(Z[34],1522805485),new B(Z[35],2643833823),new B(Z[36],2343527390),new B(Z[37],1014477480),new B(Z[38],1206759142),new B(Z[39],344077627),new B(Z[40],1290863460),new B(Z[41],3158454273),new B(Z[42],3505952657),new B(Z[43],106217008),new B(Z[44],3606008344),new B(Z[45],1432725776),new B(Z[46],1467031594),new B(Z[47],851169720),new B(Z[48],3100823752),new B(Z[49],1363258195),new B(Z[50],3750685593),new B(Z[51],3785050280),new B(Z[52],3318307427),new B(Z[53],3812723403),new B(Z[54],2003034995),new B(Z[55],3602036899),new B(Z[56],1575990012),new B(Z[57],1125592928),new B(Z[58],2716904306),new B(Z[59],442776044),new B(Z[60],593698344),new B(Z[61],3733110249),new B(Z[62],2999351573),new B(Z[63],3815920427),new B(3391569614,3928383900),new B(3515267271,566280711),new B(3940187606,3454069534),new B(4118630271,4000239992),new B(116418474,1914138554),new B(174292421,2731055270),new B(289380356,3203993006),new B(460393269,320620315),new B(685471733,587496836),new B(852142971,1086792851),new B(1017036298,365543100),new B(1126000580,2618297676),new B(1288033470,3409855158),new B(1501505948,4234509866),new B(1607167915,987167468),new B(1816402316,1246189591)],d="SHA-384"===n?[new B(3418070365,d[0]),new B(1654270250,d[1]),new B(2438529370,d[2]),new B(355462360,d[3]),new B(1731405415,d[4]),new B(41048885895,d[5]),new B(3675008525,d[6]),new B(1203062813,d[7])]:[new B(s[0],4089235720),new B(s[1],2227873595),new B(s[2],4271175723),new B(s[3],1595750129),new B(s[4],2917565137),new B(s[5],725511199),new B(s[6],4215389547),new B(s[7],327033209)]}for(e[t>>>5]|=128<<24-t%32,e[i]=t,Y=e.length,y=0;Y>y;y+=D){for(t=d[0],i=d[1],s=d[2],o=d[3],a=d[4],c=d[5],u=d[6],h=d[7],R=0;p>R;R+=1)W[R]=16>R?new B(e[R*H+y],e[R*H+y+1]):P(M(W[R-2]),W[R-7],j(W[R-15]),W[R-16]),l=q(h,X(a),z(a,c,u),Z[R],W[R]),f=L(V(t),J(t,i,s)),h=u,u=c,c=a,a=L(o,l),o=s,s=i,i=t,t=L(l,f);d[0]=L(t,d[0]),d[1]=L(i,d[1]),d[2]=L(s,d[2]),d[3]=L(o,d[3]),d[4]=L(a,d[4]),d[5]=L(c,d[5]),d[6]=L(u,d[6]),d[7]=L(h,d[7])}if("SHA-224"===n)e=[d[0],d[1],d[2],d[3],d[4],d[5],d[6]];else if("SHA-256"===n)e=d;else if("SHA-384"===n)e=[d[0].a,d[0].b,d[1].a,d[1].b,d[2].a,d[2].b,d[3].a,d[3].b,d[4].a,d[4].b,d[5].a,d[5].b];else{if("SHA-512"!==n)throw"Unexpected error in SHA-2 implementation";e=[d[0].a,d[0].b,d[1].a,d[1].b,d[2].a,d[2].b,d[3].a,d[3].b,d[4].a,d[4].b,d[5].a,d[5].b,d[6].a,d[6].b,d[7].a,d[7].b]}return e}"function"==typeof define?define(function(){return i}):"undefined"!=typeof n?"undefined"!=typeof t&&t.exports?t.exports=n=i:n=i:e.jsSHA=i}(this)},{}],4:[function(e,t){(function(n){function i(e,t,i,s){if("undefined"!=typeof n&&n.env.STREAM_URL&&!e){var o=/https\:\/\/(\w+)\:(\w+)\@([\w-]*).*\?app_id=(\d+)/.exec(n.env.STREAM_URL);e=o[1],t=o[2];var a=o[3];i=o[4],void 0===s&&(s={}),"getstream"!=a&&(s.location=a)}return new r(e,t,i,s)}var r=e("./lib/client"),s=e("./lib/errors"),o=e("request");t.exports.connect=i,t.exports.errors=s,t.exports.request=o,t.exports.Client=r}).call(this,e("1YiZ5S"))},{"./lib/client":5,"./lib/errors":6,"1YiZ5S":2,request:8}],5:[function(e,t){(function(n){var i=e("request"),r=e("./feed"),s=e("./signing"),o=e("./errors"),a=e("./utils"),c=function(){this.initialize.apply(this,arguments)};c.prototype={baseUrl:"https://api.getstream.io/api/",initialize:function(e,t,i,r){if(this.apiKey=e,this.apiSecret=t,this.appId=i,this.options=r||{},this.version=this.options.version||"v1.0",this.fayeUrl=this.options.fayeUrl||"https://faye.getstream.io/faye",this.group=this.options.group||"unspecified",this.location=this.options.location,this.location?this.baseUrl="https://"+this.location+"-api.getstream.io/api/":"undefined"!=typeof n&&n.env.LOCAL&&(this.baseUrl="http://localhost:8000/api/"),this.handlers={},this.browser="undefined"!=typeof window,this.node=!this.browser,this.browser&&this.apiSecret)throw new o.FeedError("You are publicly sharing your private key. Dont use the private key while in the browser.")},on:function(e,t){this.handlers[e]=t},off:function(e){void 0===e?this.handlers={}:delete this.handlers[e]},send:function(e){var t=Array.prototype.slice.call(arguments),e=t[0];t=t.slice(1),this.handlers[e]&&this.handlers[e].apply(this,t)},wrapCallback:function(e){function t(){var t=Array.prototype.slice.call(arguments),i=["response"].concat(t);n.send.apply(n,i),void 0!=e&&e.apply(n,t)}var n=this;return t},userAgent:function(){var e=this.node?"node":"browser",t="unknown";return"stream-javascript-client-"+e+"-"+t},feed:function(e,t,n,i){if(!e||!t)throw new o.FeedError('Please provide a feed slug and user id, ie client.feed("user", "1")');if(-1!=e.indexOf(":"))throw new o.FeedError('Please initialize the feed using client.feed("user", "1") not client.feed("user:1")');if(a.validateFeedSlug(e),a.validateUserId(t),!this.apiSecret&&!n)throw new o.FeedError("Missing token, in client side mode please provide a feed secret");if(this.apiSecret&&!n){var c=""+e+t;n=s.sign(this.apiSecret,c)}var u=new r(this,e,t,n,i);return u},enrichUrl:function(e){var t=this.baseUrl+this.version+"/"+e;return t},enrichKwargs:function(e){e.url=this.enrichUrl(e.url),void 0==e.qs&&(e.qs={}),e.qs.api_key=this.apiKey,e.qs.location=this.group,e.json=!0;var t=e.signature||this.signature;e.headers={},e.headers.Authorization=t;var n=this.node?"User-Agent":"X-Stream-Client";return e.headers[n]=this.userAgent(),e},signActivity:function(e){return this.signActivities([e])[0]},signActivities:function(e){if(!this.apiSecret)return e;for(var t=0;t<e.length;t++){for(var n=e[t],i=n.to||[],r=[],s=0;s<i.length;s++){var o=i[s],a=o.split(":")[0],c=o.split(":")[1],u=this.feed(a,c).token,h=o+" "+u;r.push(h)}n.to=r}return e},get:function(e,t){this.send("request","get",e,t),e=this.enrichKwargs(e),e.method="GET";var n=this.wrapCallback(t);return i(e,n)},post:function(e,t){this.send("request","post",e,t),e=this.enrichKwargs(e),e.method="POST";var n=this.wrapCallback(t);return i(e,n)},"delete":function(e,t){this.send("request","delete",e,t),e=this.enrichKwargs(e),e.method="DELETE";var n=this.wrapCallback(t);return i(e,n)}},t.exports=c}).call(this,e("1YiZ5S"))},{"./errors":6,"./feed":7,"./signing":9,"./utils":10,"1YiZ5S":2,request:8}],6:[function(e,t){function n(e,t){this.message=e,Error.call(this,this.message),r?Error.captureStackTrace(this,t):this.stack=s?(new Error).stack:""}var i=t.exports,r="function"==typeof Error.captureStackTrace,s=!!(new Error).stack;i._Abstract=n,n.prototype=new Error,i.FeedError=function(e){n.call(this,e)},i.FeedError.prototype=new n,i.SiteError=function(e){n.call(this,e)},i.SiteError.prototype=new n},{}],7:[function(e,t){var n=e("./errors"),i=e("./utils"),r=function(){this.initialize.apply(this,arguments)};r.prototype={initialize:function(e,t,n,i){this.client=e,this.slug=t,this.userId=n,this.id=this.slug+":"+this.userId,this.token=i,this.feedUrl=this.id.replace(":","/"),this.feedTogether=this.id.replace(":",""),this.signature=this.feedTogether+" "+this.token,this.fayeClient=null,this.notificationChannel="site-"+this.client.appId+"-feed-"+this.feedTogether},addActivity:function(e,t){var e=this.client.signActivity(e),n=this.client.post({url:"feed/"+this.feedUrl+"/",body:e,signature:this.signature},t);return n},removeActivity:function(e,t){var n=e.foreignId?e.foreignId:e,i={};e.foreignId&&(i.foreign_id="1");var r=this.client.delete({url:"feed/"+this.feedUrl+"/"+n+"/",qs:i,signature:this.signature},t);return r},addActivities:function(e,t){var e=this.client.signActivities(e),n={activities:e},i=this.client.post({url:"feed/"+this.feedUrl+"/",body:n,signature:this.signature},t);return i},follow:function(e,t,n,r){i.validateFeedSlug(e),i.validateUserId(t);var s,o=arguments[arguments.length-1],r=o.call?o:void 0,a=e+":"+t;arguments[2]&&!arguments[2].call?s=arguments[2]:arguments[3]&&!arguments[3].call&&(s=arguments[3]),this.client.apiSecret&&!s&&(s=this.client.feed(e,t).token);var c=this.client.post({url:"feed/"+this.feedUrl+"/following/",body:{target:a,target_token:s},signature:this.signature},r);return c},unfollow:function(e,t,n){i.validateFeedSlug(e),i.validateUserId(t);var r=e+":"+t,s=this.client.delete({url:"feed/"+this.feedUrl+"/following/"+r+"/",signature:this.signature},n);return s},following:function(e,t){void 0!=e&&e.filter&&(e.filter=e.filter.join(","));var n=this.client.get({url:"feed/"+this.feedUrl+"/following/",qs:e,signature:this.signature},t);return n},followers:function(e,t){void 0!=e&&e.filter&&(e.filter=e.filter.join(","));var n=this.client.get({url:"feed/"+this.feedUrl+"/followers/",qs:e,signature:this.signature},t);return n},get:function(e,t){e&&e.mark_read&&e.mark_read.join&&(e.mark_read=e.mark_read.join(",")),e&&e.mark_seen&&e.mark_seen.join&&(e.mark_seen=e.mark_seen.join(","));var n=this.client.get({url:"feed/"+this.feedUrl+"/",qs:e,signature:this.signature},t);return n},getFayeAuthorization:function(){var e=this.client.apiKey,t=this.notificationChannel,n=this.token;return{incoming:function(e,t){t(e)},outgoing:function(i,r){i.ext={user_id:t,api_key:e,signature:n},r(i)}}},getFayeClient:function(){var t=e("faye");if(null===this.fayeClient){this.fayeClient=new t.Client(this.client.fayeUrl);var n=this.getFayeAuthorization();this.fayeClient.addExtension(n)}return this.fayeClient},subscribe:function(e){if(!this.client.appId)throw new n.SiteError("Missing app id, which is needed to subscribe, use var client = stream.connect(key, secret, appId);");return this.getFayeClient().subscribe("/"+this.notificationChannel,e)}},t.exports=r},{"./errors":6,"./utils":10,faye:1}],8:[function(e,t){function n(e,t){function n(e){t(e)}function i(e){t(e)}e.params=e.qs,e.body=JSON.stringify(e.body),e.success=n,e.error=i,e.headers["Content-Type"]="application/json;charset=utf-8",Parse.Cloud.httpRequest(e)}t.exports=n},{}],9:[function(e,t,n){function i(e){var t=e.replace(/\+/g,"-").replace(/\//g,"_");return t.replace(/^=+/,"").replace(/=+$/,"")}var r=e("jssha");n.sign=function(e,t){var n=new r(e,"TEXT"),s=n.getHash("SHA-1","HEX"),o=new r(t,"TEXT"),a=o.getHMAC(s,"HEX","SHA-1","B64"),c=i(a);return c}},{jssha:3}],10:[function(e,t,n){function i(e){var t=e.split(":");if(2!=t.length)throw new errors.FeedError("Invalid feedId, expected something like user:1 got "+e);var n=t[0],i=t[1];return r(n),s(i),e}function r(e){var t=o.test(e);if(!t)throw new errors.FeedError("Invalid feedSlug, please use letters, numbers or _ got: "+e);return e}function s(e){var t=o.test(e);if(!t)throw new errors.FeedError("Invalid feedSlug, please use letters, numbers or _ got: "+e);return e}var o=/^[\w-]+$/;n.validateFeedId=i,n.validateFeedSlug=r,n.validateUserId=s},{}]},{},[4])(4)});